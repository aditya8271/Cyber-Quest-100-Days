<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberQuest 100-Days</title>
    <link rel="stylesheet" href="index.css">
    <style>
        textarea {
            height: 300px;
            width: 100%;
            box-sizing: border-box;
        }

        @media (max-width: 200px) {
            textarea {
                height: 100px;
            }
        }
    </style>
</head>

<body>
    <header>
        <h1>CyberQuest 100-Days Journey</h1>
        <p>Your roadmap to mastering cybersecurity.</p>
    </header>

    <main>
        <section id="todo-list">
            <!-- Days will be dynamically added here -->
        </section>
    </main>

    <footer>
        <p>Stay consistent and reach your goals! ðŸš€</p>
    </footer>

    <script>
        const todoList = document.getElementById('todo-list');

        // Generate 100-day sections dynamically
        for (let day = 1; day <= 100; day++) {
            const daySection = document.createElement('div');
            daySection.className = 'day';

            daySection.innerHTML = `
                <div class="day-header">
                    <button class="toggle-btn" onclick="toggleDay(${day})">âž•</button>
                    <h2>Day ${day}</h2>
                    <input type="checkbox" id="complete-${day}" class="complete-checkbox" disabled>
                    <label for="complete-${day}">Completed</label>
                </div>
                <div class="form-group">
                    <label for="learned-topics-${day}">Learned Topics</label>
                    <textarea id="learned-topics-${day}" placeholder="What topics did you actually learn?"></textarea>
                </div>
                <button onclick="saveDay(${day})" id="save-btn-${day}">Save</button>
                <button onclick="deleteDay(${day})" id="delete-btn-${day}" class="delete-btn">Delete</button>
            `;

            todoList.appendChild(daySection);
        }

        // Function to toggle day visibility
        function toggleDay(day) {
            const daySection = document.querySelector(`.day:nth-child(${day})`);
            const toggleBtn = daySection.querySelector('.toggle-btn');
            const formGroup = daySection.querySelectorAll('.form-group');

            if (formGroup[0].style.display === 'none') {
                formGroup.forEach(item => item.style.display = 'block');
                toggleBtn.textContent = 'âž–';
            } else {
                formGroup.forEach(item => item.style.display = 'none');
                toggleBtn.textContent = 'âž•';
            }
        }

        // Function to toggle completed state
        function toggleCompleted(day) {
            const daySection = document.querySelector(`.day:nth-child(${day})`);
            const checkbox = document.getElementById(`complete-${day}`);

            if (checkbox.checked) {
                daySection.style.backgroundColor = '#d4edda';
                daySection.querySelector('h2').style.textDecoration = 'line-through';
            } else {
                daySection.style.backgroundColor = '#ffffff';
                daySection.querySelector('h2').style.textDecoration = 'none';
            }
        }

        // Function to save learned topics
        function saveDay(day) {
            const learnedTextarea = document.getElementById(`learned-topics-${day}`);
            const saveButton = document.getElementById(`save-btn-${day}`);
            const completeCheckbox = document.getElementById(`complete-${day}`);

            // Disable the textareas and save button
            learnedTextarea.disabled = true;
            saveButton.disabled = true;

            // Mark as completed
            completeCheckbox.checked = true;
            toggleCompleted(day);

            // Save to the backend (using fetch API)
            const topicsData = learnedTextarea.value;
            const completed = completeCheckbox.checked;

            fetch('http://localhost:5000/save-topic', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ day, topics: topicsData, completed })
            })
            .then(response => response.json())
            .then(data => console.log(data.message))
            .catch(error => console.error('Error saving data:', error));
        }

        // Function to delete learned topics
        function deleteDay(day) {
            const learnedTextarea = document.getElementById(`learned-topics-${day}`);
            const saveButton = document.getElementById(`save-btn-${day}`);
            const completeCheckbox = document.getElementById(`complete-${day}`);

            // Clear textareas
            learnedTextarea.value = '';

            // Enable the textareas and save button
            learnedTextarea.disabled = false;
            saveButton.disabled = false;

            // Unmark as completed
            completeCheckbox.checked = false;
            toggleCompleted(day);

            // Remove data from the backend
            fetch(`http://localhost:5000/delete-topic/${day}`, { method: 'DELETE' })
                .then(response => response.json())
                .then(data => console.log(data.message))
                .catch(error => console.error('Error deleting data:', error));
        }

        // Load saved data when the page loads
        window.onload = function () {
            for (let day = 1; day <= 100; day++) {
                const learnedTextarea = document.getElementById(`learned-topics-${day}`);
                const saveButton = document.getElementById(`save-btn-${day}`);
                const completeCheckbox = document.getElementById(`complete-${day}`);

                fetch('http://localhost:5000/topics')
                    .then(response => response.json())
                    .then(topics => {
                        const topicForDay = topics.find(topic => topic.day === day);
                        if (topicForDay) {
                            learnedTextarea.value = topicForDay.topics;

                            // Disable the textareas and save button if data exists
                            learnedTextarea.disabled = true;
                            saveButton.disabled = true;

                            // Check if the day is completed
                            completeCheckbox.checked = topicForDay.completed;
                            toggleCompleted(day);
                        }
                    })
                    .catch(error => console.error('Error loading topics:', error));
            }
        };
    </script>
</body>

</html>
